# Quest 5: Secure Parking with NFC

Authors: Eric Chen, Jacob Chin, Celine Chen, Weinuo Lin

Date: 2023-12-6

### Summary
The Secure Parking with NFC is intended to use a fob system for parking spaces using Near-Field Communication (NFC) technology. By utilizing methods such as Infrared (IR) communications and QR code encoding, the project can enhance security by exchanging information from the userâ€™s fob and the parking meter. The ESP-32 microcontroller is an integral component of the fob and the meter. The fob consists of IR communication components and a Pi Camera to scan a QR code on the meter powered through a Raspberry Pi Zero. The meter consists of the ESP-32 microcontroller. These devices communicate within a subnet to reach a server hosted on a Raspberry Pi Zero. The node.js server communicates with a tingoDB database to denote whether a parking spot is taken.

#### Key Fob Electronics
The fob consists of an ESP-32 module powering the IR communication module, a Pi Camera module that reads the QR code on the parking meter, and the three LEDs to display the status. The ESP-32 sends the fob ID to the meter using IR TX/RX upon a button press. When sent, the LED colors on the key fob would change to yellow to show that the determination of the status is in progress. When the button is pressed, the message sent to the parking meter is what generates the QR code which the Pi camera scans. The LED will change after the server sends the status back to the key fob. The LED changes to yellow when it is in the process of finding the status of the parking space, red for the parking space being taken, and green for the parking space being not taken. 

#### Parking Meter Electronics
The parking meter consists of an ESP-32 module, an OLED display, and three LEDs to display the status of the parking space. When receiving the fob ID from the IR TX/RX communication, the OLED display will display a QR code intended for the key fob to scan with the Pi camera. While doing so, the LED colors will serve as an indicator. When the QR code is displayed, the yellow LED lights up to indicate that the status confirmation is in progress. The LED changes after the server sends the status back to the parking meter. 

#### OLED Display
Once the parking meter receives the IR TX/RX communication from the key fob, the OLED display will display a QR code that enables the key fob to scan the QR code. This QR code will display for 10 seconds and then disappear. We chose this for security reasons since displaying it the whole time could lead to potential issues in taking other's FobID. 

#### Server on separate PI
This server facilitates communication between the fob and the meter. After the fob scans the QR code generated by the meter using the Pi Camera, the Pi Camera sends the MeterID and FobID. Then, the server uses this information to authenticate and check the status of the parking space using a database we implemented using TingoDB. If the MeterID and FobID do not exist in the database, then the status for that parking space will now be taken since the driver will now park there. And if it does exist in the database, then the status for the parking space will now be not taken since the driver will leave the space. The status is sent to the fob and meter using a UDP socket. The server sends the updated status, MeterID, FobID, and timestamp to the HTML displayed on our web for users to see the availability of the parking spaces in the parking lot. 


### Self-Assessment 

## Rubric

| Objective Criterion | Rating | Max Value  | 
|---------------------------------------------|:-----------:|:---------:|
| Fob sends (IR TX/RX) FID to meter | 1 |  1     | 
| Meter ESP displays QR code with MID, FID | 1 |  1     | 
| Fob Pi reads QR code on meter and sends (WiFi) to Auth Server with MID,FID | 1 |  1     | 
| DB logs MID, FID, timestamp and validates meter available; sends (WiFi) MID, status to fob and meter | 1 |  1     | 
| Meter evaluates status and sets LEDs to indicate booking | 1 |  1     | 
| Web client accesses Auth Server to show logged data and meter status | 1 |  1     | 
| Auth Server implemented in TingoDB and on separate Pi | 1 |  1     | 
| Investigative question response | 1 |  1     | 





### Sketches/Diagrams
Code Flow Chart
![Quest 5](https://github.com/BU-EC444/Team1-Squigglies-Lin-Chen-Chin-Chen/assets/108195485/0d74e6f1-0a21-4995-a9be-933862a73778)

Circuit Diagram of our Secure Parking with NFC
Circuit diagram of Parking Meter
<img width="1235" alt="Screenshot 2023-12-05 at 2 53 53 PM" src="https://github.com/BU-EC444/Team1-Squigglies-Lin-Chen-Chin-Chen/assets/108195485/1f0f9dd9-7a94-4d05-95b2-e03acdb77e56">

Circuit diagram of Key fob
<img width="1168" alt="Screenshot 2023-12-05 at 2 54 48 PM" src="https://github.com/BU-EC444/Team1-Squigglies-Lin-Chen-Chin-Chen/assets/108195485/beae84ef-fa4e-47c8-b0e2-97c5ef532e74">


State Machine of the Secure Parking System Behavior
Fob State Machine
<img width="802" alt="Screenshot 2023-12-05 at 2 21 02 PM" src="https://github.com/BU-EC444/Team1-Squigglies-Lin-Chen-Chin-Chen/assets/99696770/f5ca13db-509c-4d56-bf85-5c5e8ad55068">

Meter State Machine
<img width="868" alt="Screenshot 2023-12-05 at 2 21 14 PM" src="https://github.com/BU-EC444/Team1-Squigglies-Lin-Chen-Chin-Chen/assets/99696770/bbbd446b-2790-4888-8797-195cc562df7e">

Web server for parking space avaliability
When parking space is not taken
![image](https://github.com/BU-EC444/Team1-Squigglies-Lin-Chen-Chin-Chen/assets/99696770/dd300116-7bc0-45d0-853f-32c1432ead0b)

When parking space is taken
![image-2](https://github.com/BU-EC444/Team1-Squigglies-Lin-Chen-Chin-Chen/assets/99696770/0be6d4e8-90c2-406a-a353-15c0cd9cebbd)





### Supporting Artifacts
- [Investigative question]
[Quest_5_Question.pdf](https://github.com/BU-EC444/Team1-Squigglies-Lin-Chen-Chin-Chen/files/13592103/Quest_5_Question.pdf)

- [technical presentation]
https://drive.google.com/file/d/1gF8idGPwQSmBQI9Y3MrU0BwY880xJ02j/view?usp=sharing
- [demo video]
https://drive.google.com/file/d/1Lp8e3toy6pgkrCFtqrLhlPKS4A3HFOWl/view?usp=sharing

